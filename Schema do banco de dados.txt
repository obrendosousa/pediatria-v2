create table public.appointments (
  id bigserial not null,
  created_at timestamp with time zone null default now(),
  doctor_name text not null,
  start_time timestamp with time zone not null,
  status text null default 'available'::text,
  patient_name text null,
  patient_phone text null,
  notes text null,
  doctor_id bigint null,
  constraint appointments_pkey primary key (id),
  constraint appointments_doctor_id_fkey foreign KEY (doctor_id) references doctors (id)
) TABLESPACE pg_default;

create table public.chat_messages (
  id bigserial not null,
  created_at timestamp with time zone null,
  phone text null,
  nomewpp text null,
  bot_message text null,
  user_message text null,
  message_type text null,
  active boolean null default true,
  chat_id bigint null,
  sender text null,
  message_text text null,
  constraint chat_messages_pkey primary key (id),
  constraint chat_messages_chat_id_fkey foreign KEY (chat_id) references chats (id)
) TABLESPACE pg_default;

create table public.chats (
  id bigserial not null,
  created_at timestamp with time zone null,
  phone text null,
  updated_at text null,
  followup_1_sent boolean null default false,
  followup_3_sent boolean null default false,
  followup_7_sent boolean null default false,
  agendamento boolean null default false,
  status text null default 'ACTIVE'::text,
  last_interaction_at timestamp with time zone null default now(),
  followup_level integer null default 0,
  stage text null default 'new'::text,
  priority text null default 'normal'::text,
  tags text[] null default '{}'::text[],
  assigned_to bigint null,
  ai_summary text null,
  ai_sentiment text null default 'neutral'::text,
  reception_status text null default 'waiting'::text,
  appointment_date date null,
  notes text null,
  appointment_time time without time zone null,
  queue_order integer null default 999,
  constraint chats_pkey primary key (id),
  constraint chats_assigned_to_fkey foreign KEY (assigned_to) references doctors (id)
) TABLESPACE pg_default;

create table public.dados_cliente (
  id bigserial not null,
  created_at timestamp with time zone null,
  telefone text null,
  nomewpp text null,
  atendimento_ia text null,
  constraint dados_cliente_pkey primary key (id)
) TABLESPACE pg_default;

create table public.doctor_schedules (
  id bigserial not null,
  doctor_id bigint null,
  day_of_week integer not null,
  start_time time without time zone not null,
  end_time time without time zone not null,
  slot_duration integer null default 30,
  constraint doctor_schedules_pkey primary key (id),
  constraint unique_schedule_slot unique (doctor_id, day_of_week, start_time, end_time),
  constraint doctor_schedules_doctor_id_fkey foreign KEY (doctor_id) references doctors (id)
) TABLESPACE pg_default;

create table public.doctors (
  id bigserial not null,
  name text not null,
  specialty text null,
  color text null default 'blue'::text,
  active boolean null default true,
  constraint doctors_pkey primary key (id)
) TABLESPACE pg_default;

create table public.documents (
  id bigserial not null,
  content text null,
  metadata jsonb null,
  embedding public.vector null,
  constraint documents_pkey primary key (id)
) TABLESPACE pg_default;

create table public.leads_advogados (
  id uuid not null default gen_random_uuid (),
  google_place_id text not null,
  nome_escritorio text not null,
  nome_contato text null,
  telefone_whatsapp text null,
  website text null,
  endereco_completo text null,
  cidade text null,
  estado text null,
  nota_media numeric(2, 1) null,
  numero_avaliacoes integer null,
  areas_atuacao text[] null,
  status_contato text not null default 'Pendente'::text,
  nome_identificado boolean not null default false,
  data_disparo timestamp with time zone null,
  resumo_ia text null,
  dados_brutos_json jsonb null,
  data_criacao timestamp with time zone not null default now(),
  ultima_atualizacao timestamp with time zone not null default now(),
  constraint leads_advogados_pkey primary key (id),
  constraint leads_advogados_google_place_id_key unique (google_place_id),
  constraint leads_advogados_telefone_whatsapp_key unique (telefone_whatsapp)
) TABLESPACE pg_default;

create table public.n8n_chat_histories (
  id serial not null,
  session_id character varying(255) not null,
  message jsonb not null,
  constraint n8n_chat_histories_pkey primary key (id)
) TABLESPACE pg_default;

create table public.patients (
  id bigint generated by default as identity not null,
  chat_id bigint null,
  name text not null,
  birth_date date not null,
  notes text null,
  created_at timestamp with time zone null default timezone ('utc'::text, now()),
  constraint patients_pkey primary key (id),
  constraint patients_chat_id_fkey foreign KEY (chat_id) references chats (id) on delete CASCADE
) TABLESPACE pg_default;

create table public.products (
  id bigint generated by default as identity not null,
  name text not null,
  description text null,
  price_cost numeric(10, 2) null default 0,
  price_sale numeric(10, 2) not null,
  stock integer null default 0,
  category text null,
  active boolean null default true,
  created_at timestamp with time zone null default timezone ('utc'::text, now()),
  constraint products_pkey primary key (id)
) TABLESPACE pg_default;

create table public.sale_items (
  id bigint generated by default as identity not null,
  sale_id bigint null,
  product_id bigint null,
  quantity integer null default 1,
  unit_price numeric(10, 2) not null,
  created_at timestamp with time zone null default timezone ('utc'::text, now()),
  constraint sale_items_pkey primary key (id),
  constraint sale_items_product_id_fkey foreign KEY (product_id) references products (id),
  constraint sale_items_sale_id_fkey foreign KEY (sale_id) references sales (id) on delete CASCADE
) TABLESPACE pg_default;

create table public.sales (
  id bigint generated by default as identity not null,
  chat_id bigint null,
  total numeric(10, 2) null default 0,
  status text null default 'pending'::text,
  payment_method text null,
  created_at timestamp with time zone null default timezone ('utc'::text, now()),
  constraint sales_pkey primary key (id),
  constraint sales_chat_id_fkey foreign KEY (chat_id) references chats (id)
) TABLESPACE pg_default;

create table public.schedule_overrides (
  id bigserial not null,
  doctor_id bigint null,
  override_date date not null,
  is_available boolean null default true,
  start_time time without time zone null,
  end_time time without time zone null,
  reason text null,
  created_at timestamp with time zone null default now(),
  constraint schedule_overrides_pkey primary key (id),
  constraint schedule_overrides_doctor_id_override_date_start_time_key unique (doctor_id, override_date, start_time),
  constraint schedule_overrides_doctor_id_fkey foreign KEY (doctor_id) references doctors (id)
) TABLESPACE pg_default;

create table public.tasks (
  id bigint generated by default as identity not null,
  chat_id bigint null,
  type text not null,
  description text not null,
  due_date date null default CURRENT_DATE,
  status text null default 'pending'::text,
  created_at timestamp with time zone null default timezone ('utc'::text, now()),
  constraint tasks_pkey primary key (id),
  constraint tasks_chat_id_fkey foreign KEY (chat_id) references chats (id) on delete CASCADE
) TABLESPACE pg_default;